{"componentChunkName":"component---src-templates-docs-template-js","path":"/docs/online/rbac/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"rbac\" style=\"position:relative;\"><a href=\"#rbac\" aria-label=\"rbac permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RBAC</h1>\n<p>Hawtio installation comes with a default <code>hawtio-rbac</code> <em>ConfigMap</em> <a href=\"../deploy/base/configmap-hawtio-rbac.yml\">configmap-hawtio-rbac.yml</a>, that contains the configuration file used to define the roles allowed for MBean operations.\nThis <em>ConfigMap</em> is mounted into the Hawtio Online container, and the <code>HAWTIO_ONLINE_RBAC_ACL</code> environment variable is used to pass the configuration file path to the server.\nIf that environment variable is not set, RBAC support is disabled, and only users granted the <code>update</code> verb on the pod resources are authorized to call MBeans operations.</p>\n<h2 id=\"roles\" style=\"position:relative;\"><a href=\"#roles\" aria-label=\"roles permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Roles</h2>\n<p>For the time being, only the <code>viewer</code> and <code>admin</code> roles are supported.\nOnce the current invocation is authenticated, these roles are inferred from the permissions the user impersonating the request is granted for the pod hosting the operation being invoked.</p>\n<p>A user that's granted the <code>update</code> verb on the pod resource is bound to the <code>admin</code> role, i.e.:</p>\n<pre><code class=\"language-sh\">$ oc auth can-i update pods/&#x3C;pod> --as &#x3C;user>\nyes\n</code></pre>\n<p>Else, a user granted the <code>get</code> verb on the pod resource is bound the <code>viewer</code> role, i.e.:</p>\n<pre><code class=\"language-sh\">$ oc auth can-i get pods/&#x3C;pod> --as &#x3C;user>\nyes\n</code></pre>\n<p>Otherwise the user is not bound any roles, i.e.:</p>\n<pre><code class=\"language-sh\">$ oc auth can-i get pods/&#x3C;pod> --as &#x3C;user>\nno\n</code></pre>\n<h2 id=\"acl\" style=\"position:relative;\"><a href=\"#acl\" aria-label=\"acl permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ACL</h2>\n<p>The ACL definition for JMX operations works as follows:</p>\n<p>Based on the <em>ObjectName</em> of the JMX MBean, a key composed with the <em>ObjectName</em> domain, optionally followed by the <code>type</code> attribute, can be declared, using the convention <code>&#x3C;domain>.&#x3C;type></code>.\nFor example, the <code>java.lang.Threading</code> key for the MBean with the <em>ObjectName</em> <code>java.lang:type=Threading</code> can be declared.\nA more generic key with the domain only can be declared (e.g. <code>java.lang</code>).\nA <code>default</code> top-level key can also be declared.\nA key can either be an unordered or ordered map, whose keys can either be string or regexp, and whose values can either be string or array of strings, that represent roles that are allowed to invoke the MBean member.</p>\n<p>The default ACL definition can be found in the <code>hawtio-rbac</code> <em>ConfigMap</em> from the <code>deployment-cluster-rbac.yml</code> and <code>deployment-namespace-rbac.yml</code> templates.</p>\n<h2 id=\"authorization\" style=\"position:relative;\"><a href=\"#authorization\" aria-label=\"authorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authorization</h2>\n<p>The system looks for allowed roles using the following process:</p>\n<p>The most specific key is tried first. E.g. for the above example, the <code>java.lang.Threading</code> key is looked up first.\nIf the most specific key does not exist, the domain-only key is looked up, otherwise, the <code>default</code> key is looked up.\nUsing the matching key, the system looks up its map value for:</p>\n<ol>\n<li>\n<p>An exact match for the operation invocation, using the operation signature, and the invocation arguments, e.g.:</p>\n<p><code>uninstall(java.lang.String)[0]: [] # no roles can perform this operation</code></p>\n</li>\n<li>\n<p>A regexp match for the operation invocation, using the operation signature, and the invocation arguments, e.g.:</p>\n<p><code>/update\\(java\\.lang\\.String,java\\.lang\\.String\\)\\[[1-4]?[0-9],.*\\]/: admin</code></p>\n<p>Note that, if the value is an ordered map, the iteration order is guaranteed, and the first matching regexp key is selected;</p>\n</li>\n<li>\n<p>An exact match for the operation invocation, using the operation signature, without the invocation arguments, e.g.:</p>\n<p><code>delete(java.lang.String): admin</code></p>\n</li>\n<li>\n<p>An exact match for the operation invocation, using the operation name, e.g.:</p>\n<p><code>dumpStatsAsXml: admin, viewer</code></p>\n</li>\n</ol>\n<p>If the key matches the operation invocation, it is used and the process will not look for any other keys. So the most specific key always takes precedence.\nIts value is used to match the role that impersonates the request, against the roles that are allowed to invoke the operation.\nIf the current key does not match, the less specific key is looked up and matched following the steps 1 to 4 above, up until the <code>default</code> key.\nOtherwise, the operation invocation is denied.</p>","frontmatter":{"title":""}}},"pageContext":{"slug":"/docs/online/rbac/"}}}