<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RBAC :: Hawtio</title>
    <meta name="generator" content="Antora 3.1.10">
<link rel='stylesheet' href='../../_/css/site.css' />
<link rel='stylesheet' href='../../_/css/docs.css' />
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">
        <img src="../../_/img/hawtio_logo.svg" alt="Hawtio" height="40px" />
      </a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/">Home</a>
        <a class="navbar-item" href="/docs/get-started.html">Get Started</a>
        <a class="navbar-item" href="/docs/">Docs</a>
        <a class="navbar-item" href="/docs/plugins.html">Plugins</a>
        <a class="navbar-item" href="https://github.com/hawtio/hawtio/releases">Download</a>
        <a class="navbar-item" href="/community/">Community</a>
        <a class="navbar-item" href="https://github.com/hawtio/hawtio">
          <img src="../../_/img/social/github-light-32.png" alt="GitHub" height="20px" />
        </a>
        <a class="navbar-item" href="https://twitter.com/hawtio">
          <img src="../../_/img/social/twitter-white.png" alt="Twitter" height="20px" />
        </a>
        <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/hawtio">
          <img src="../../_/img/social/stackoverflow.png" alt="StackOverflow" height="20px" />
        </a>
      </div>
    </div>
  </nav>
</header>

<div class="body">
<div class="nav-container" data-component="docs" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-v3.html">Hawtio v3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started.html">Get Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../versions.html">Supported Versions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Using Hawtio</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins.html">Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../keycloak.html">Keycloak Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../oidc.html">OpenID Connect Integration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Kubernetes/OpenShift</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openshift.html">OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kubernetes.html">Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="create-user.html">Creating a Hawtio user for Form authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="generate-certificates.html">Generating Certificates Manually</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="rbac.html">RBAC</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="develop.html">Development</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">General Docs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../releases.html">Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributing.html">Contributor Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Developers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developers/history.html">A bit of history</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developers/architecture.html">Hawtio Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developers/applications.html">Developing Hawtio applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developers/plugins.html">Developing Hawtio plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../releasing.html">Releasing Hawtio</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Documentation</a>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Documentation</a></li>
    <li>Kubernetes/OpenShift</li>
    <li><a href="rbac.html">RBAC</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/hawtio/website/blob/main/modules/ROOT/pages/online/rbac.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">RBAC</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hawtio installation comes with a default <code>hawtio-rbac</code> <em>ConfigMap</em> <a href="https://github.com/hawtio/hawtio-online/blob/main/deploy/base/configmap-hawtio-rbac.yml">configmap-hawtio-rbac.yml</a>, that contains the configuration file used to define the roles allowed for MBean operations.
This <em>ConfigMap</em> is mounted into the Hawtio Online container, and the <code>HAWTIO_ONLINE_RBAC_ACL</code> environment variable is used to pass the configuration file path to the server.
If that environment variable is not set, RBAC support is disabled, and only users granted the <code>update</code> verb on the pod resources are authorized to call MBeans operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_roles"><a class="anchor" href="#_roles"></a>Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the time being, only the <code>viewer</code> and <code>admin</code> roles are supported.
Once the current invocation is authenticated, these roles are inferred from the permissions the user impersonating the request is granted for the pod hosting the operation being invoked.</p>
</div>
<div class="paragraph">
<p>A user that&#8217;s granted the <code>update</code> verb on the pod resource is bound to the <code>admin</code> role, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc auth can-i update pods/&lt;pod&gt; --as &lt;user&gt;
yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Else, a user granted the <code>get</code> verb on the pod resource is bound the <code>viewer</code> role, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc auth can-i get pods/&lt;pod&gt; --as &lt;user&gt;
yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise the user is not bound any roles, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc auth can-i get pods/&lt;pod&gt; --as &lt;user&gt;
no</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_role_with_the_minimum_permissions"><a class="anchor" href="#_creating_a_role_with_the_minimum_permissions"></a>Creating a Role with the Minimum Permissions</h4>
<div class="paragraph">
<p>The following creates a role with the minimum permissions required for connecting and
viewing existing pods. Once created, a user can be bound to it with a
<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding" class="external" target="_blank" rel="noopener">role-binding</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cat &lt;&lt;EOF | kubectl create -f -
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: hawtio-viewer
rules:
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - pods/proxy
  verbs:
  - get
  - list
  - watch
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - localsubjectaccessreviews
  verbs:
  - create
EOF</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acl"><a class="anchor" href="#_acl"></a>ACL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ACL definition for JMX operations works as follows:</p>
</div>
<div class="paragraph">
<p>Based on the <em>ObjectName</em> of the JMX MBean, a key composed with the <em>ObjectName</em> domain, optionally followed by the <code>type</code> attribute, can be declared, using the convention <code>&lt;domain&gt;.&lt;type&gt;</code>.
For example, the <code>java.lang.Threading</code> key for the MBean with the <em>ObjectName</em> <code>java.lang:type=Threading</code> can be declared.
A more generic key with the domain only can be declared (e.g. <code>java.lang</code>).
A <code>default</code> top-level key can also be declared.
A key can either be an unordered or ordered map, whose keys can either be string or regexp, and whose values can either be string or array of strings, that represent roles that are allowed to invoke the MBean member.</p>
</div>
<div class="paragraph">
<p>The default ACL definition can be found in the <code>hawtio-rbac</code> <em>ConfigMap</em> from the <code>deployment-cluster-rbac.yml</code> and <code>deployment-namespace-rbac.yml</code> templates.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authorization"><a class="anchor" href="#_authorization"></a>Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The system looks for allowed roles using the following process:</p>
</div>
<div class="paragraph">
<p>The most specific key is tried first. E.g. for the above example, the <code>java.lang.Threading</code> key is looked up first.
If the most specific key does not exist, the domain-only key is looked up, otherwise, the <code>default</code> key is looked up.
Using the matching key, the system looks up its map value for:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An exact match for the operation invocation, using the operation signature, and the invocation arguments, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>uninstall(java.lang.String)[0]: [] # no roles can perform this operation</pre>
</div>
</div>
</li>
<li>
<p>A regexp match for the operation invocation, using the operation signature, and the invocation arguments, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>/update\(java\.lang\.String,java\.lang\.String\)\[[1-4]?[0-9],.*\]/: admin</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, if the value is an ordered map, the iteration order is guaranteed, and the first matching regexp key is selected;</p>
</div>
</li>
<li>
<p>An exact match for the operation invocation, using the operation signature, without the invocation arguments, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>delete(java.lang.String): admin</pre>
</div>
</div>
</li>
<li>
<p>An exact match for the operation invocation, using the operation name, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>dumpStatsAsXml: admin, viewer</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the key matches the operation invocation, it is used and the process will not look for any other keys. So the most specific key always takes precedence.
Its value is used to match the role that impersonates the request, against the roles that are allowed to invoke the operation.
If the current key does not match, the less specific key is looked up and matched following the steps 1 to 4 above, up until the <code>default</code> key.
Otherwise, the operation invocation is denied.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
